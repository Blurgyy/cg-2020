# Assignment 1

## 测试环境

OS: Arch Linux (5.10.6-zen1-1-zen)
g++: 10.2.0
CMake: 3.19.3

## 使用方法

进入文件夹后执行

```shell
$ cmake -S . -B build && cd build && make
```

进行编译, 编译得到的二进制可执行文件为 `build/zbuffer`.

要执行可执行文件, 需要一个**完全由三角形组成的** `obj` 格式的模型文件, 使用方
式是把模型文件的路径作为参数:

```shell
$ ./build/zbuffer model.obj
```

执行后, 程序会用面片的法向确定面片的颜色, 并统计三种绘制方式在绘制时 (不包含建
立层次 zbuffer 和场景八叉树的时间) 所需时间并将信息输出到 `stdout`, 同时保存三
个 `ppm` 格式的图片.

### 参数

直接执行 `./build/zbuffer` 而不提供参数, 程序将输出可选参数并退出.

- `-h|--help` 显示可选参数并退出.
- `-r|--resolution <WxH>` 指定输出图像的分辨率, 默认为 1920x1080.
- `-f|--field-of-view <fov>` 指定绘制时相机在 `y` 方向的视角 (度), 默认为 45.
- `-o|--output <path>` 指定保存的图像文件名, 默认为 `zbuffer.ppm`.

## 实验结果

进行了三次实验, 分别对比了不同大小的输入模型对加速效果的影响; 不同的相机视角对
加速效果的影响, 不同分辨率对加速效果的影响.

### 实验一: 不同大小的模型

实验中输出图像的分辨率为 1920x1080, 绘制时的相机视角由场景八叉树的根节点所表示
的立方体确定 (根据场景生成的默认视角), 程序的输入模型不同.

|绘制方式|spaceship (55120 个面片)|bedroom (2249813 个面片)|
|:---:|:---:|:---:|
|naive|`143`ms|`774`ms|
|层次 zbuffer|`173`ms (`+20.98%`)|`751`ms (`-2.97%`)|
|层次 zbuffer + 场景八叉树|`168`ms (`+17.48%`)|`748`ms (`-3.36%`)|

||spaceship (55120 个面片)|bedroom (2249813 个面片)|
|:---:|:---:|:---:|
|绘制结果|![][fig:exp1-spaceship]|![][fig:exp1-bedroom]|

### 实验二: 不同相机视角

实验中输出图像的分辨率为 1920x1080, 使用的都是 bedroom 模型 (2249813 个面片),
绘制时的相机视角不同 (都不是默认视角).

||视角 1| 视角 2|
|:---:|:---:|:---:|
|naive|`545`ms|`1291`ms|
|层次 zbuffer|`624`ms (`+14.50%`)|`1195`ms (`-7.43%`)|
|层次 zbuffer + 场景八叉树|`622`ms (`+14.13%`)|`1190`ms (`-7.82%`)|

||视角 1|视角 2|
|:---:|:---:|:---:|
|绘制结果|![][fig:exp2-viewpoint1]|![][fig:exp2-viewpoint2]|

### 实验三: 不同分辨率

实验中使用的都是 bedroom 模型 (2249813 个面片), 使用默认视角, 输出图像的分辨率
不同.

||1024x768|1920x1080|3840x2160|
|:---:|:---:|:---:|:---:|
|naive|`488`ms|`779`ms|`2558`ms|
|层次 zbuffer|`441`ms (`-9.63%`)|`748`ms (`-3.98%`)|`2580`ms (`+0.86%`)|
|层次 zbuffer + 场景八叉树|`439`ms (`-10.04%`)|`753`ms (`-3.33%`)|`2576`ms (`+0.70%`)|

|||1920x1080|3840x2160|
|:---:|:---:|:---:|:---:|
|绘制结果|![][fig:exp3-1024x768]|![][fig:exp3-1920x1080]|![][fig:exp3-3840x2160]|

## 结果分析

> 1. 在两种输入规模下的实验结果中可以看出, 在模型面片较少时, 层次 zbuffer 与场景
> 八叉树对绘制有减速效果 (实验一); 模型面片数较多时才能有加速效果 (实验二).
> 2. 在实验二的绘制结果图中可以看出, 绘制时相机看向模型的视角也对加速效果有很重
> 要的作用.  房间模型的天花板遮挡了许多房间内的物体, 这时候场景八叉树在景物空
> 间就可以进行较好的 "early rejection".
> 3. 在输出图像 2K 与 4K 分辨率的对比实验中可以看出, 在同一视角下

[fig:exp1-spaceship]: ./media/exp1/spaceship.png
[fig:exp1-bedroom]: ./media/exp1/bedroom.png

[fig:exp2-viewpoint1]: ./media/exp2/viewpoint1.png
[fig:exp2-viewpoint2]: ./media/exp2/viewpoint2.png

[fig:exp3-1024x768]: ./media/exp3/1024x768.png
[fig:exp3-1920x1080]: ./media/exp3/1920x1080.png
[fig:exp3-3840x2160]: ./media/exp3/3840x2160.png

> Author: Blurgy <gy@blurgy.xyz>
> Date:   Jan 14 2021, 14:58 [CST]
